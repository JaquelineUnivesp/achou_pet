{% extends 'core/base.html' %}
{% block title %}Cadastrar Pet para Reprodução - Achou Pet{% endblock %}
{% block content %}

<div class="container mt-5">
   <div class="row">
      <div class="col-3">
         {% include "core/sidebar_user.html" %}
      </div>

         <h1 class="display-1 text-center">Cadastro de pet para <span class="color_project">reprodução</span></h1>
         <p class="text-center">Ajude a encontrar um parceiro para seu pet!</p>

         {% if form.errors %}
         <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <strong>Erro ao cadastrar:</strong>
            <ul>
               {% for field in form %}
               {% for error in field.errors %}
               <li>{{ field.label }}: {{ error }}</li>
               {% endfor %}
               {% endfor %}
               {% for error in form.non_field_errors %}
               <li>{{ error }}</li>
               {% endfor %}
            </ul>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
         </div>
         {% endif %}

         <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="container">
               <div class="row mb-4">
                  <div class="col-md-6">
                     <label for="id_pet_name" class="form-label fw-bold">Nome do Pet</label><br>
                     {{ form.pet_name }}
                  </div>
                  <div class="col-md-6">
                     <label for="id_age_value" class="form-label fw-bold">Idade</label><br>
                     <div class="input-group">
                        {{ form.age_value }}
                        {{ form.age_unit }}
                     </div>
                  </div>
               </div>
               <div class="row mb-4">
                  <div class="col-md-4">
                     <label for="id_species" class="form-label fw-bold">Espécie</label><br>
                     {{ form.species }}
                  </div>
                  <div class="col-md-4">
                     <label for="id_sex" class="form-label fw-bold">Sexo</label><br>
                     {{ form.sex }}
                  </div>
                  <div class="col-md-4">
                     <label for="id_size_by_age" class="form-label fw-bold">Tamanho (Idade)</label><br>
                     {{ form.size_by_age }}
                  </div>
               </div>
               <div class="row mb-4">
                  <div class="col-md-4">
                     <label for="id_breed" class="form-label fw-bold">Raça</label><br>
                     {{ form.breed }}
                  </div>
                  <div class="col-md-4">
                     <label for="id_color" class="form-label fw-bold">Cor</label><br>
                     {{ form.color }}
                  </div>
                  <div class="col-md-4">
                     <label for="id_weight" class="form-label fw-bold">Peso</label><br>
                     {{ form.weight }}
                  </div>

               <div class="row mb-4">
                  <div class="col-md-6">
                     <label for="id_coat_type" class="form-label fw-bold">Tipo de Pelagem</label><br>
                     {{ form.coat_type }}
                  </div>
                  <div class="col-md-6">
                     <label for="id_eye_color" class="form-label fw-bold">Cor dos Olhos</label><br>
                     {{ form.eye_color }}
                  </div>
               </div>
               <div class="row mb-4">
                  <div class="col-md-6">
                     <label for="id_is_neutered" class="form-label fw-bold">Castrado?</label><br>
                     {{ form.is_neutered }}
                  </div>
                  <div class="col-md-6">
                     <label for="id_is_vaccinated" class="form-label fw-bold">Vacinado?</label><br>
                     {{ form.is_vaccinated }}
                  </div>
               </div>
               <div class="row mb-4">
                  <div class="col-md-6">
                     <label for="id_has_pedigree" class="form-label fw-bold">Possui Pedigree?</label><br>
                     {{ form.has_pedigree }}
                  </div>
                  <div class="col-md-6">
                     <label for="id_has_bred_before" class="form-label fw-bold">Já Cruzou Antes?</label><br>
                     {{ form.has_bred_before }}
                  </div>
               </div>
                <div class="col-md-4">
                  <label for="id_health_issues" class="form-label fw-bold">Problemas de Saúde</label><br>
                  {{ form.health_issues }}
               </div>
                <div class="col-md-4">
                  <label for="id_pedigree_details" class="form-label fw-bold">Detalhes do Pedigree</label><br>
                  {{ form.pedigree_details }}
               </div>
                <div class="col-md-4">
                  <label for="id_breeding_history" class="form-label fw-bold">Histórico de Cruzamento</label><br>
                  {{ form.breeding_history }}
               </div>
                <div class="col-md-4">
                  <label for="id_breeding_reason" class="form-label fw-bold">Motivo do Cruzamento</label><br>
                  {{ form.breeding_reason }}
               </div>
                <div class="col-md-4">
                  <label for="id_puppy_preferences" class="form-label fw-bold">Preferências de Filhotes</label><br>
                  {{ form.puppy_preferences }}
               </div>
               <div class="col-md-4">
                  <label for="id_cost_sharing" class="form-label fw-bold">Divisão de Custos</label><br>
                  {{ form.cost_sharing }}
               </div>


                </div>




                <div class="col-md-6>
                  <label for="id_notification_phone">Telefone de Notificação</label>
                 {{ form.phone_for_notifications }}
               </div>

               <div class="row mb-4">
                  <div class="col-md-4">
                     <label for="id_photo_1" class="form-label fw-bold">Foto 1</label><br>
                     {{ form.photo_1 }}
                  </div>
                  <div class="col-md-4">
                     <label for="id_photo_2" class="form-label fw-bold">Foto 2</label><br>
                     {{ form.photo_2 }}
                  </div>
                  <div class="col-md-4">
                     <label for="id_photo_3" class="form-label fw-bold">Foto 3</label><br>
                     {{ form.photo_3 }}
                  </div>
               </div>
               <div class="mb-4">
                  <label for="id_location" class="form-label fw-bold">Endereço</label><br>
                  {{ form.location }}
                  {{ form.latitude }}
                  {{ form.longitude }}
                  <div id="map" style="height: 300px; width: 100%; margin-top: 10px; background-color: #e0e0e0;"></div>
                  <small class="text-muted">Clique ou arraste no mapa para ajustar a localização</small>
               </div>
               <div class="mb-4">
                  <div class="form-check">
                     {{ form.terms_accepted }}
                     <label class="form-check-label" for="id_terms_accepted">Concordo com os <a href="#">Termos de Uso</a></label>
                  </div>
                  <div class="form-check">
                     {{ form.privacy_policy_accepted }}
                     <label class="form-check-label" for="id_privacy_policy_accepted">Concordo com a <a href="#">Política de Privacidade</a></label>
                  </div>
               </div>
               <button type="submit" class="btn background_project" style="  background-color: #e25d95; border:#e25d95;  color:#fff; margin: 5px;"">Cadastrar</button>
            </div>
         </form>

   </div>
</div>

<!-- Bootstrap CSS and JS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<!-- Leaflet and LocationIQ Geocoder -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://tiles.locationiq.com/v3/libs/leaflet-geocoder/1.9.6/leaflet-geocoder-locationiq.min.js"></script>
<link rel="stylesheet" href="https://tiles.locationiq.com/v3/libs/leaflet-geocoder/1.9.6/leaflet-geocoder-locationiq.min.css">
<script>
    var map = L.map('map').setView([-23.5489, -46.6388], 13); // São Paulo como padrão
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19 }).addTo(map);
    var marker = null;

    // Função para arredondar coordenadas
    function roundToSixDecimals(num) {
        return Number(num.toFixed(6));
    }

    // Geolocalização inicial
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(position) {
            var lat = roundToSixDecimals(position.coords.latitude);
            var lon = roundToSixDecimals(position.coords.longitude);
            map.setView([lat, lon], 13);
            reverseGeocode(lat, lon);
            marker = L.marker([lat, lon]).addTo(map);
            document.getElementById('id_latitude').value = lat;
            document.getElementById('id_longitude').value = lon;
        });
    }

    // Adicionar o controle de busca LocationIQ
    var geocoder = L.control.geocoder('pk.227bb16be8af10a97550047d4932e148', {
        url: "https://api.locationiq.com/v1",
        expanded: true,
        panToPoint: true,
        focus: false,
        position: "topleft"
    }).addTo(map);

    // Evento quando um local é selecionado no autocomplete
    geocoder.on('select', function(e) {
        var lat = roundToSixDecimals(e.latlng.lat);
        var lon = roundToSixDecimals(e.latlng.lng);
        var address = e.feature.display_name;
        console.log('Local selecionado:', lat, lon, address);
        document.getElementById('id_location').value = address;
        document.getElementById('id_latitude').value = lat;
        document.getElementById('id_longitude').value = lon;
        if (marker) marker.remove();
        marker = L.marker([lat, lon]).addTo(map);
    });

    // Clique no mapa para ajustar
    map.on('click', function(e) {
        var lat = roundToSixDecimals(e.latlng.lat);
        var lon = roundToSixDecimals(e.latlng.lng);
        fetch(`https://api.locationiq.com/v1/reverse?key=pk.227bb16be8af10a97550047d4932e148&lat=${lat}&lon=${lon}&format=json`)
            .then(response => response.json())
            .then(data => {
                console.log('Reverse geocode data:', data);
                document.getElementById('id_location').value = data.display_name;
                document.getElementById('id_latitude').value = lat;
                document.getElementById('id_longitude').value = lon;
                if (marker) marker.remove();
                marker = L.marker([lat, lon]).addTo(map);
            })
            .catch(error => console.error('Erro no reverse geocode:', error));
    });

    // Função para reverse geocode (chamada na geolocalização)
    function reverseGeocode(lat, lon) {
        fetch(`https://api.locationiq.com/v1/reverse?key=pk.227bb16be8af10a97550047d4932e148&lat=${lat}&lon=${lon}&format=json`)
            .then(response => response.json())
            .then(data => {
                document.getElementById('id_location').value = data.display_name;
                document.getElementById('id_latitude').value = lat;
                document.getElementById('id_longitude').value = lon;
            })
            .catch(error => console.error('Erro no reverse geocode:', error));
    }
</script>




<script>
const breedsCats = [
  "Sem Raça", "Abissínio", "American Bobtail", "American Curl", "American Shorthair",
  "Balinese", "Bengal", "Birmanês", "Bombaim", "British Shorthair",
  "Burmês", "Chartreux", "Cornish Rex", "Devon Rex", "Egyptian Mau",
  "Exótico", "Himalaio", "Japanese Bobtail", "Korat", "LaPerm",
  "Maine Coon", "Manx", "Florestal Norueguês", "Ocicat", "Oriental",
  "Persa", "Ragdoll", "Azul Russo", "Scottish Fold", "Selkirk Rex",
  "Siamês", "Siberiano", "Singapura", "Snowshoe", "Somali", "Sphynx",
  "Tonquinês", "Angorá Turco", "Van Turco", "Outra Raça"
];

const breedsDogs = [
  "Sem Raça", "Pastor Alemão", "Pastor Belga", "Pastor de Shetland",
  "Affenpinscher", "Afghan Hound", "Airedale Terrier", "Akita",
  "Alaskan Malamute", "American Bulldog", "American Pit Bull Terrier",
  "Australian Cattle Dog", "Australian Shepherd", "Basset Hound",
  "Beagle", "Belgian Malinois", "Bernese Mountain Dog", "Bichon Frisé",
  "Bloodhound", "Border Collie", "Boston Terrier", "Boxer",
  "Bull Terrier", "Bulldog Francês", "Bulldog Inglês", "Cairn Terrier",
  "Cane Corso", "Cavalier King Charles Spaniel", "Chihuahua",
  "Chow Chow", "Cocker Spaniel", "Collie", "Dachshund", "Dálmata",
  "Doberman", "Dogo Argentino", "Golden Retriever", "Dog Alemão",
  "Greyhound", "Havanês", "Jack Russell Terrier", "Labrador Retriever",
  "Lhasa Apso", "Maltês", "Mastiff", "Pinscher Miniatura",
  "Terra Nova", "Papillon", "Pequinês", "Corgi", "Poodle",
  "Spitz Alemão", "Pug", "Rottweiler", "São Bernardo",
  "Samoyeda", "Schnauzer", "Scottish Terrier", "Shar Pei", "Shiba Inu",
  "Shih Tzu", "Husky Siberiano", "Staffordshire Bull Terrier",
  "Weimaraner", "West Highland Terrier", "Whippet", "Yorkshire Terrier",
  "Outra Raça"
];

const speciesSelect = document.getElementById('id_species');
const breedSelect = document.getElementById('id_breed');

function updateBreeds() {
  const species = speciesSelect.value;
  const breeds = species === 'cat' ? breedsCats : breedsDogs;

  breedSelect.innerHTML = '';  // limpa opções
  breeds.forEach(breed => {
    const option = document.createElement('option');
    option.value = breed;
    option.textContent = breed;
    breedSelect.appendChild(option);
  });
}

// ao carregar a página
updateBreeds();

// quando mudar a espécie
speciesSelect.addEventListener('change', updateBreeds);
</script>




{% endblock %}
